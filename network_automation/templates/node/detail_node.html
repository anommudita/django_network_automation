{% extends 'main.html' %}
{% load static %}

{% block content %}

<!-- main konten -->
    <!-- flash message -->
        {% for message in messages %}
        <div class="container-fluid p-0">

            <div class="alert {{ message.tags }} alert-dismissible fade show col-6" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
        {% endfor %}
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="{% static 'plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
    <script src="{% static 'plugins/sweetalert2/myscript.js' %}"></script>

    <!-- end flash message -->
    <div class="d-flex pt-3 mb-4">
        <button class="btn btn-danger dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
            Install
        </button>

        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            {% if ceph == 'N/A' %}
                <li><a href="/detail-node/{{id_node}}/install-ceph" class="dropdown-item install-ceph">Ceph</a></li>
            {% else %}
                <li><button type="button" class="dropdown-item" disabled>Ceph Already Instal</button></li>
            {% endif %}
            <li><a href="/detail-node/{{id_node}}/install-iptables" class="dropdown-item">Iptables-persistent</a></li>
        </ul>

        <div class="ms-auto">
            <a class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#portforwarding">Port Forwarding</a>
            <a href="/node-network/{{id_node}}" class="btn btn-success mr-2">Add Network</a>
            <a class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addContainer" data-modal="addContainer">Add Container</a>
            <a class="btn btn-primary ml-2" data-bs-toggle="modal" data-bs-target="#addVirtualMachine" data-modal="addVirtualMachine">Add Virtual Machine</a>
        </div>
    </div>
    



    {% if container is None %}
        <div class="col-12 col-lg-12 col-xxl-12 order-xxl-4 pt-3">
            <div class="card flex-fill ">
                <div class="card-body d-flex align-items-center" style="height: 300px;">
                    <h1 class="text-center mx-auto">Container is Empty</h1>
                </div>
            </div>
        </div>
    {% else  %}
        <!-- Container -->
        <H3>Container</H3>
        <input class="id_node" type="text" value="{{id_node}}" hidden>
        <!-- <div class="row" id="data-container"> -->
        <div class="row" id="data-container">
        <!-- container -->
        <!-- {% for row in container %}
            <div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
                <div class="card flex-fill w-100">
                    <div class="d-flex justify-content-end">
                        <a href="/detail-container/{{row.vmid}}" class="btn btn-primary mt-3">Detail</a>
                        <div>
                            &nbsp; &nbsp; &nbsp;
                        </div>
                    </div>


                    <div class="card-header">
                        <h5 class="card-title mb-0 pb-2">{{row.name}}</h5>
                        {% if row.status == "stopped"%}
                            <span class="badge bg-danger">Stopped</span>
                        {% else %}
                            <span class="badge bg-success">Running</span>
                        {% endif %}

                    </div>

                    <div class="py-3 mx-auto">
                        <div class="chart chart-xs">
                            <i class="align-middle me-1" data-feather="box" style="width: 180px; height: 180px;"></i>
                        </div>
                    </div>

                    <div class="card-body d-flex">
                        <div class="align-self-center w-100">
                            <table class="table mb-0">
                                <tbody>
                                    <p id="">Data akan ditampilkan di sini</p>
                                    <tr>
                                        <td>CPU</td>
                                        <td class="text-end" id="cpu"></td>
                                    </tr>
                                    <tr>
                                        <td>Memori</td>
                                        <td class="text-end" id="memori"></td>

                                    </tr>
                                    <tr>
                                        <td>Storage</td>
                                        <td class="text-end" id="disk"></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class=" pt-3">
                                <div class="text-center mt-2">
                                    <a href="/start-container/{{id_node}}/{{row.vmid}}" class="btn btn-success mr-3 start-container">Start</a>
                                    <a href="/stop-container/{{id_node}}/{{row.vmid}}" class="btn btn-warning mr-3 stop-container">Stop</a>
                                    <a href="/reboot-container/{{id_node}}/{{row.vmid}}" class="btn btn-primary mr-3 reboot-container">Reboot</a>
                                </div>

                                <div class="text-center">
                                    <a href="/remove-container/{{id_node}}//{{row.vmid}}" class="btn btn-danger mt-3 text remove-container">Remove</a>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                </div>
            </div>
        {% endfor%}   -->
        

        </div>


    {% endif %}
    

    {% if virtual_machine is None %}
        <div class="col-12 col-lg-12 col-xxl-12 order-xxl-4">
            <div class="card flex-fill ">
                <div class="card-body d-flex align-items-center" style="height: 300px;">
                    <h1 class="text-center mx-auto">Virtual Machine is Empty</h1>
                </div>
            </div>
        </div>

    {% else  %}
        <!-- Virtual Machine -->
        <H3>Virtual Machine</H3>
        <div class="row" id="data-vm"></div>
        <!-- {% for row in virtual_machine %}
            <div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
                <div class="card flex-fill w-100">

                    <div class="d-flex justify-content-end">
                        <a href="/detail-virtual_machine/{{row.vmid}}" class="btn btn-primary mt-3">Detail</a>
                        <div>
                            &nbsp; &nbsp; &nbsp;
                        </div>
                    </div>

                    <div class="card-header">
                        <h5 class="card-title mb-0 pb-2">{{row.name}}</h5>
                        {% if row.status == "stopped"%}
                            <span class="badge bg-danger">Stopped</span>
                        {% else %}
                            <span class="badge bg-success">Running</span>
                        {% endif %}

                    </div>

                    <div class="py-3 mx-auto">
                        <div class="chart chart-xs">
                            <i class="align-middle me-1" data-feather="airplay" style="width: 180px; height: 180px;"></i>
                        </div>
                    </div>

                    <div class="card-body d-flex">
                        <div class="align-self-center w-100">

                            <table class="table mb-0">
                                <tbody>
                                    <p id="">Data akan ditampilkan di sini</p>
                                    <tr>
                                        <td>CPU</td>
                                        <td class="text-end" id="cpu"></td>
                                    </tr>
                                    <tr>
                                        <td>Memori</td>
                                        <td class="text-end" id="memori"></td>

                                    </tr>
                                    <tr>
                                        <td>Storage</td>
                                        <td class="text-end" id="disk"></td>
                                    </tr>
                                </tbody>
                            </table>

                            <div class=" pt-3">
                                <div class="text-center mt-2">
                                    <a href="/start-virtual_machine/{{id_node}}/{{row.vmid}}" class="btn btn-success mr-3 start-virtual_machine">Start</a>
                                    <a href="/stop-virtual_machine/{{id_node}}/{{row.vmid}}" class="btn btn-warning mr-3 stop-virtual_machine">Stop</a>
                                    <a href="/reboot-virtual_machine/{{id_node}}/{{row.vmid}}" class="btn btn-primary mr-3 reboot-virtual_machine">Reboot</a>
                                </div>

                                <div class="text-center">
                                    <a href="/remove-virtual_machine/{{id_node}}//{{row.vmid}}" class="btn btn-danger mt-3 text remove-virtual_machine">Remove</a>
                                </div>

                                
                            </div>
                            
                        </div>
                    </div>
                    
                </div>
            </div>
        {% endfor%}   -->
        
    {% endif%}
        <div class="modal fade" id="portforwarding" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="card bg-white border-0 mb-0">
                            <div class="card-header bg-transparent">
                                <h2 class="card-heading text-center" id="routeTitle">Post Routing</h2>
                            </div>
                            <div class="card-body">
                                <div id="postRouteForm" >
                                    <form action="{% url 'post-route' id_node=id_node %}" id="postRouting" method="post">
                                        {% csrf_token %}
                                        <!-- Common Fields -->
                                        <!-- Name -->

                                        <!-- Password -->
                                        <div class="form-group mb-4">
                                            <label>Interfaces : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fa-solid fa-network-wired fa-2x "></i></span>
                                                </div>
                                                <select name="network_interfaces" class="form-control" id="network_interfaces">
                                                    <option value="">Pilih..</option>
                                                    {% for row in network %}
                                                        <option value="{{row.iface}}">{{row.iface}} - {{row.type}}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group mb-4">
                                            <label>Destination Port : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fa-solid fa-ethernet fa-2x "></i></span>
                                                </div>
                                                <input class="form-control" name="dst_port" id="dst_port" placeholder="Enter Dest Port" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>

                                        <div class="form-group mb-4">
                                            <label>Destination IP : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">IP</span>
                                                </div>
                                                <input class="form-control" name="dst_ip" id="dst_ip" placeholder="Enter Dest IP" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>

                                        <div class="form-group mb-4">
                                            <label>Source IP : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">IP</span>
                                                </div>
                                                <input class="form-control" name="src_ip" id="src_ip" placeholder="Enter Src IP" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>

                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary" id="postRouteButton">Submit</button>
                                        </div>
                                    </form>
                                </div>

                                <div id="preRouteForm" style="display: none;">
                                    <form action="{% url 'pre-route' id_node=id_node %}" id="preRouting" method="post">
                                        {% csrf_token %}
                                        <!-- Common Fields -->
                                        <!-- ... -->
            
                                        <!-- Name -->
                                        <div class="form-group mb-4">
                                            <label>Interfaces : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fa-solid fa-network-wired fa-2x "></i></span>
                                                </div>
                                                <select name="network_interfaces" class="form-control" id="network_interfaces">
                                                    <option value="">Pilih..</option>
                                                    {% for row in network %}
                                                        <option value="{{row.iface}}">{{row.iface}} - {{row.type}}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>

                                        <div class="form-group mb-4">
                                            <label>Source Port : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text"><i class="fa-solid fa-ethernet fa-2x "></i></span>
                                                </div>
                                                <input class="form-control" name="src_port" id="src_port" placeholder="Enter Src Port" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>

                                        <div class="form-group mb-4">
                                            <label>IP:Port : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">IP</span>
                                                </div>
                                                <input class="form-control" name="ip" id="ip" placeholder="Enter IP" type="text" autocomplete="off" value="">
                                                <div class="input-group-append">
                                                    <span class="input-group-text">:</span>
                                                </div>
                                                <input class="form-control" name="port" id="port" placeholder="Port" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>
                                        <div class="text-center">
                                            <button type="submit" class="btn btn-primary" id="preRouteButton">Submit</button>
                                        </div>
                                    </form>
                                </div>

                                
                                <br>
                                <div class="text-center">
                                    <button type="button" class="btn btn-secondary" id="toggleForm">Switch Form</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- modalbox tambah Container -->
        <div class="modal fade" id="addContainer" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="card bg-white border-0 mb-0">
                            <div class="card-header bg-transparent">
                                <h2 class="card-heading text-center">Add Container</h2>
                            </div>
                            <!-- circles -->
                            <div style="text-align:center;margin-top:40px;">
                                <span class="step-addContainer"></span>
                                <span class="step-addContainer"></span>
                                <span class="step-addContainer"></span>
                                <span class="step-addContainer"></span>
                                <span class="step-addContainer"></span>
                                <span class="step-addContainer"></span>
                                <span class="step-addContainer"></span>
                            </div>

                            <!-- card body -->
                            <div class="card-body">
                                <form action="{% url 'add-container' id_node=id_node %}" id="formaddContainer" method="POST">
                                    {% csrf_token %}

                                    <!-- Tab 1 -->
                                    <div class="form-group mb-4 tab tab-addContainer">

                                        <h2 class="">General :</h2>
                                        <br>

                                        <!-- ct_id -->
                                        <label for="ct-id">CT ID : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-box  fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="ct-id" id="ct-id" placeholder="Enter CT-ID" type="number" autocomplete="off">
                                        </div>

                                        <br>

                                        <!-- hostname -->
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-desktop fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="hostname" id="hostname" placeholder="Enter Hostname" type="text" autocomplete="off">
                                        </div>

                                        <br>

                                        <!-- resource_pool -->
                                        <label for="resource_pool">Resource Pool : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-earth-asia fa-2x "></i></span>
                                            </div>

                                            <select name="resource_pool" class="form-control" id="resource_pool">
                                                <option value="">Pilih..</option>
                                                
                                                {% for row in resource_pool %}
                                                    <option value="{{row.poolid}}">{{row.poolid}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <br>

                                        <!-- password -->
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-lock fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="password" id="password" placeholder="Enter Password" type="password" autocomplete="off" value="">
                                        </div>

                                        <br>

                                        <!-- ssh key -->
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-key fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="ssh_key" id="ssh_key" placeholder="Enter SSH Public KEY" type="text" autocomplete="off" value="">
                                        </div>
                                    </div>

                                    <!-- Tab 2 -->
                                    <div class="form-group mb-4 tab tab-addContainer">

                                        <h2 class="">Templates :</h2>
                                        <br>

                                        <!-- Storage -->
                                        <label for="storage_container">Storage : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-database fa-2x "></i></span>
                                            </div>

                                            <select name="storage_container" class="form-control" id="storage_container">
                                                <option value="local" selected>local</option>
                                            </select>
                                        </div>

                                        <br>

                                        <!-- Templates -->
                                        <label for="container_templated">Tempaltes : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-compact-disc fa-2x "></i></span>
                                            </div>

                                            <select name="container_templated" class="form-control" id="container_templated">
                                                <option value="">Pilih..</option>
                                                {% for row in iso_container %}
                                                    <option value="{{row.volid}}">{{row.volid}} | {{row.format}} | {{row.size}} MB</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                    </div>

                                    <!-- Tab 3 -->
                                    <div class="form-group mb-4 tab tab-addContainer">

                                        <h2 class="">Disks :</h2>
                                        <br>

                                        <!-- Storage -->
                                        <label for="storage_disk">Storage : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-database fa-2x "></i></span>
                                            </div>

                                            <select name="storage_disk" class="form-control" id="storage_disk">
                                                <option value="local-lvm" selected>local-lvm</option>
                                            </select>
                                        </div>

                                        <br>

                                        <!-- Disk Size -->
                                        <label for="disk_size">Disk Size (GiB): </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-hard-drive fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="disk_size" id="disk_size"  type="number" autocomplete="off" value="8">
                                        </div>

                                    </div>

                                    <!-- Tab 4 -->
                                    <div class="form-group mb-4 tab tab-addContainer">

                                        <h2 class="">CPU :</h2>
                                        <br>

                                        <!-- Cores -->
                                        <label for="cores">Cores : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-brain fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="cores" id="cores"  type="number" autocomplete="off" value="1">
                                        </div>

                                    </div>

                                    <!-- Tab 5 -->
                                    <div class="form-group mb-4 tab tab-addContainer">

                                        <h2 class="">Memory :</h2>
                                        <br>

                                        <!-- Memori -->
                                        <label for="memory">Memory (MiB): </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-sd-card fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="memory" id="memory" type="number" autocomplete="off" value="512">
                                        </div>

                                        <br>

                                        <!-- Swap -->
                                        <label for="memori_swap">Swap (MiB) : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-sd-card fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="memory_swap" id="memory_swap" type="number" autocomplete="off" value="512">
                                        </div>

                                    </div>

                                    <!-- Tab 6 -->
                                    <div class="form-group mb-4 tab tab-addContainer">
                                        <h2 class="">Network :</h2>
                                        <br>
                                        
                                        <!-- Name Network -->
                                        <label for="network_name">Name : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-globe fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="network_name" id="network_name" type="text" autocomplete="off" value="eth0">
                                        </div>

                                        <br>

                                        <!-- Network -->
                                        <label for="network_interfaces">Interfaces : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-network-wired fa-2x "></i></span>
                                            </div>
                                            <select name="network_interfaces" class="form-control" id="network_interfaces">
                                                <option value="">Pilih..</option>
                                                {% for row in network %}
                                                    <option value="{{row.iface}}">{{row.iface}} - {{row.type}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <br>

                                        <!-- IP Address 4 Static or DHCP? -->
                                        <div class="row">
                                            <div class="col-2">IPV4 : </div>
                                            <div class="col-3">
                                                <div class="d-flex align-items-center">
                                                    <input type="radio" id="static_ipv4" name="static_ipv4" value="1">
                                                    <label for="static_ipv4" style="margin-right: 20px;">Static</label>
                                                </div>
                                            </div>

                                            <div class="col-3">
                                                <div class="d-flex align-items-center">
                                                    <input type="radio" id="dhcp_ipv4" name="dhcp_ipv4" value="1">
                                                    <label for="dhcp_ipv4" style="margin-right: 20px;">DHCP</label>
                                                </div>
                                            </div>
                                        </div>

                                        <br>

                                        <!-- IPv4/CIDR -->
                                        <div class="form-group">
                                            <label for="ipv4_network">IPv4 CIDR : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">IPv4</span>
                                                </div>
                                                <input class="form-control" name="ipv4_network" id="ipv4_network" placeholder="Enter IP Address V4" type="text" autocomplete="off" value="">
                                                <div class="input-group-append">
                                                    <span class="input-group-text">/</span>
                                                </div>
                                                <input class="form-control" name="netmask" id="netmask" placeholder="Netmask" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>
                                        <br>
                                        
                                        <!-- Gateway network -->
                                        <div class="form-group mb-4">
                                            <div class="form-group">
                                                <label for="gateway_network" id="gatewayIPV4">Gateway Network :</label>
                                                <input type="text" class="form-control" id="gateway_network" name="gateway_network">
                                            </div>
                                        </div>
                                        
                                    </div>

                                    <!-- Tab 7 -->
                                    <!-- Confirm -->
                                    <!-- data yang sudah dinputkan -->
                                    <div class="form-group mb-4 tab tab-addContainer">
                                        <div class="card flex-fill">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Confirm Configuration</h5>
                                            </div>
                                            <table class="table table-hover my-0">
                                                <thead>
                                                    <tr>
                                                        <th>KEY</th>
                                                        <th class="d-none d-xl-table-cell">VALUE</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="log-table-body">

                                                    <tr>
                                                        <td>CT ID</td>
                                                        <!-- ct-id inputan -->
                                                        <td id="confirm_ct-id"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Core</td>
                                                        <!-- core inputan -->
                                                        <td id="confirm_core"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Hostname</td>
                                                        <!-- hostname inputan -->
                                                        <td id="confirm_hostname"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Memory</td>
                                                        <!-- memory inputan -->
                                                        <td id="confirm_memory"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Net</td>
                                                        <!-- net inputan -->
                                                        <td id="confirm_net"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>ostemplate</td>
                                                        <!-- template inputan -->
                                                        <td id="confirm_ostemplate"></td>
                                                    </tr>
                                                    <tr>
                                                        <td>Pool</td>
                                                        <!-- pool inputan -->
                                                        <td id="confirm_pool"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Rootfs</td>
                                                        <!-- rootfs inputan -->
                                                        <td id="confirm_rootfs"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Swap</td>
                                                        <!-- swap inputan -->
                                                        <td id="confirm_swap"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>                            
                                    <br>

                                    <div style="overflow:auto;">
                                        <div style="float:right;">
                                        <button class="btn btn-primary" type="button" id="prevBtn_addContainer" onclick="nextPrev(-1, 'addContainer')">Previous</button>
                                        <button class="btn btn-success" type="button" id="nextBtn_addContainer" onclick="nextPrev(1, 'addContainer')">Next</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        </div>
        <!-- end modalbox tambah Container -->



        <!-- modalbox tambah Virtual Machine -->
        <div class="modal fade" id="addVirtualMachine" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="card bg-white border-0 mb-0">
                            <div class="card-header bg-transparent">
                                <h2 class="card-heading text-center">Add Virtual Machine</h2>
                            </div>

                            <!-- circles -->
                            <div style="text-align:center;margin-top:40px;">
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                                <span class="step-addVirtualMachine"></span>
                            </div>
                            <div class="card-body">
                                <form action="{% url 'add-virtual-machine' id_node=id_node %}" id="formaddVirtualMachine" method="POST">

                                    {% csrf_token %}

                                    <!-- Tab 1 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <h2 class="">General :</h2>
                                        <br>

                                        <!-- vm_id -->
                                        <label for="ct-id">VM-ID : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-box  fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="vm-id" id="vm-id" placeholder="Enter VM-ID" type="number" autocomplete="off">
                                        </div>

                                        <br>

                                        <!-- name VM -->
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-desktop fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="name_vm" id="name_vm" placeholder="Enter Name Virtual Machine" type="text" autocomplete="off">
                                        </div>

                                        <br>

                                        <!-- resource_pool -->
                                        <label for="resource_pool_vm">Resource Pool : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-earth-asia fa-2x "></i></span>
                                            </div>

                                            <select name="resource_pool_vm" class="form-control" id="resource_pool_vm">
                                                <option value="">Pilih..</option>
                                                
                                                {% for row in resource_pool %}
                                                    <option value="{{row.poolid}}">{{row.poolid}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Tab 2 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">

                                        <h2 class="">OS :</h2>
                                        <br>

                                        <!-- ISO Image -->
                                        <label for="iso_images">ISO Image : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-compact-disc fa-2x "></i></span>
                                            </div>
                                            <select name="iso_images" class="form-control" id="iso_images">
                                                <option value="">Pilih..</option>
                                                {% for row in iso_virtual_machine %}
                                                    <option value="{{row.volid}}">{{row.volid}} | {{row.format}} | {{row.size}} MB</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <br>

                                        <!-- ostype-->
                                        <label for="ostype">OS Type : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-brands fa-ubuntu fa-2x "></i></span>
                                            </div>
                                            <select name="ostype" class="form-control" id="ostype">
                                                <!-- linux -->
                                                <option value="l26" selected>Linux - Kernel 2.6 -6.X</option>
                                                <option value="l24">Linux - Kernel 2.4</option>
                                                <!-- Windows -->
                                                <option value="win11">Mircosoft Windows 11|2022</option>
                                                <option value="win10">Mircosoft Windows 10|2016/2019</option>
                                                <option value="win8">Mircosoft Windows 8|2012/2012r2</option>
                                                <option value="win7">Mircosoft Windows 7</option>
                                                <option value="wvista">Mircosoft Windows Vista</option>
                                                <option value="w2k8">Mircosoft Windows 2008</option>
                                                <option value="w2k3">Mircosoft Windows 2003</option>
                                                <option value="w2k">Mircosoft Windows 2000</option>
                                                <option value="wxp">Mircosoft Windows XP</option>

                                                <!-- solaris -->
                                                <option value="solaris">solaris/OpenSolaris/OpenIndiania kernel</option>

                                                <!-- other os -->
                                                <option value="other">Other - Unspecified OS</option>
                                                
                                            </select>
                                        </div>

                                    </div>

                                    <!-- Tab 3 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <h2 class="">Systems :</h2>
                                        <br>
                                        <!-- Machine -->
                                        <label for="machine">Machine : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-gears fa-2x "></i></span>
                                            </div>
                                            <select name="machine" class="form-control" id="machine">
                                                <option value="pc" selected >Default (i440fx)</option>
                                                <option value="q35">q35</option>
                                            </select>
                                        </div>
                                        <br>

                                        <!-- BIOS -->
                                        <label for="bios">BIOS : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-brands fa-rev fa-2x "></i></span>
                                            </div>
                                            <select name="bios" class="form-control" id="bios">
                                                <option value="seabios" selected >Default (SeaBIOS)</option>
                                            </select>
                                        </div>
                                        <br>

                                        <!-- SCSI Controller -->
                                        <label for="scsihw">SCSI Controller : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-gamepad fa-2x "></i></span>
                                            </div>
                                            <select name="scsihw" class="form-control" id="scsihw">
                                                <option value="lsi">Default (LSI 53C895A)</option>
                                                <option value="lsi53c810">LSI 53C810</option>
                                                <option value="megasas">MegaRAID SAS 8708EM2</option>
                                                <option value="virtio-scsi-pci">VirtIO SCSI</option>
                                                <option value="virtio-scsi-single" selected>VirtIO SCSI single</option>
                                                <option value="pvscsi">VMware PVSCSI</option>
                                            </select>
                                        </div>

                                        <br>

                                        <!-- Qemu Agent -->
                                        <div class="form-group mb-4">
                                            <div class="form-check d-flex align-items-center">
                                                <input class="form-check-input" type="checkbox" id="qemuAgent" name="qemuAgent">
                                                <label class="form-check-label ml-2" for="qemuAgent">
                                                    Qemu Agent
                                                </label>
                                            </div>
                                        </div>                                        
                                        
                                    </div>

                                    <!-- Tab 4 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <h2 class="">Disk :</h2>
                                        <br>
                                        <!-- Storage -->
                                        <label for="storage_virtual_machine">Storage : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-database fa-2x "></i></span>
                                            </div>

                                            <select name="storage_virtual_machine" class="form-control" id="storage_virtual_machine">
                                                <option value="local-lvm" selected>local-lvm</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Disk Size -->
                                        <label for="disk_size_vm">Disk Size (GiB): </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-hard-drive fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="disk_size_vm" id="disk_size_vm"  type="number" autocomplete="off" value="32">

                                        </div>
                                    </div>

                                    <!-- Tab 5 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <h2 class="">CPU :</h2>
                                        <br>
                                        <!-- Socket -->
                                        <label for="sockets">Sockets : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-chess-board fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="sockets" id="sockets"  type="number" autocomplete="off" value="1">
                                        </div>

                                        <br>
                                        <!-- Cores -->
                                        <label for="cores_vm">Cores : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-brain fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="cores_vm" id="cores_vm"  type="number" autocomplete="off" value="1">
                                        </div>

                                    </div>

                                    <!-- Tab 6 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <h2 class="">Memory :</h2>
                                        <br>
                                        <!-- Memori -->
                                        <label for="memory_vm">Memory (MiB): </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-sd-card fa-2x "></i></span>
                                            </div>
                                            <input class="form-control" name="memory_vm" id="memory_vm" type="number" autocomplete="off" value="2048">
                                        </div>
                                    </div>

                                    <!-- Tab 7 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <h2 class="">Network :</h2>
                                        <br>

                                        <!-- Bridge -->
                                        <label for="bridge_vm">Bridge : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-network-wired fa-2x "></i></span>
                                            </div>
                                            <select name="bridge_vm" class="form-control" id="bridge_vm">
                                                <option value="">Pilih..</option>
                                                {% for row in network %}
                                                    <option value="{{row.iface}}">{{row.iface}} - {{row.type}}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <br>

                                        <!-- Model Network -->
                                        <label for="model_network">Model : </label>
                                        <div class="input-group input-group-merge input-group-alternative">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text"><i class="fa-solid fa-diagram-project fa-2x "></i></span>
                                            </div>
                                            <select name="model_network" class="form-control" id="model_network">
                                                <option value="e1000">Intel E1000</option>
                                                <option value="virtio" selected>VirtIO (paravirtualized)</option>
                                                <option value="rtl8139">Realtek RTL8139</option>
                                                <option value="vmxnet3">VMware vmxnet3</option>
                                            </select>        
                                        </div>

                                        <br>

                                        <!-- IP Address 4 Static or DHCP? -->
                                        <div class="row">
                                            <div class="col-2">IPV4 : </div>
                                            <div class="col-3">
                                                <div class="d-flex align-items-center">
                                                    <input type="radio" id="static_ipv4_vm" name="static_ipv4_vm" value="1">
                                                    <label for="static_ipv4_vm" style="margin-right: 20px;">Static</label>
                                                </div>
                                            </div>

                                            <div class="col-3">
                                                <div class="d-flex align-items-center">
                                                    <input type="radio" id="dhcp_ipv4_vm" name="dhcp_ipv4_vm" value="1">
                                                    <label for="dhcp_ipv4_vm" style="margin-right: 20px;">DHCP</label>
                                                </div>
                                            </div>
                                        </div>

                                        <br>

                                        <!-- IPv4/CIDR -->
                                        <div class="form-group">
                                            <label for="ipv4_network_vm">IPv4 CIDR : </label>
                                            <div class="input-group input-group-merge input-group-alternative">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text">IPv4</span>
                                                </div>
                                                <input class="form-control" name="ipv4_network_vm" id="ipv4_network_vm" placeholder="Enter IP Address V4" type="text" autocomplete="off" value="">
                                                <div class="input-group-append">
                                                    <span class="input-group-text">/</span>
                                                </div>
                                                <input class="form-control" name="netmask_vm" id="netmask_vm" placeholder="Netmask" type="text" autocomplete="off" value="">
                                            </div>
                                        </div>
                                        <br>
                                        
                                        <!-- Gateway network -->
                                        <div class="form-group mb-4">
                                            <div class="form-group">
                                                <label for="gateway_network_vm">Gateway Network :</label>
                                                <input type="text" class="form-control" id="gateway_network_vm" name="gateway_network_vm">
                                            </div>
                                        </div>

                                        
                                        <!-- Firewall VM -->
                                        <div class="form-group mb-4">
                                            <div class="form-check d-flex align-items-center">
                                                <input class="form-check-input" type="checkbox" id="firewall_vm" name="firewall_vm" checked>
                                                <label class="form-check-label ml-2" for="firewall_vm">
                                                    Firewall
                                                </label>
                                            </div>
                                        </div>     
                                    </div>

                                    <!-- Tab 8 -->
                                    <div class="form-group mb-4 tab tab-addVirtualMachine">
                                        <div class="card flex-fill">
                                            <div class="card-header">
                                                <h5 class="card-title mb-0">Confirm Configuration</h5>
                                            </div>
                                            <table class="table table-hover my-0">
                                                <thead>
                                                    <tr>
                                                        <th>KEY</th>
                                                        <th class="d-none d-xl-table-cell">VALUE</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="log-table-body">

                                                    <tr>
                                                        <td>Cores</td>
                                                        <!-- cores inputan -->
                                                        <td id="confirm_core_vm"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Ide2</td>
                                                        <!-- ide2 inputan -->
                                                        <td id="confirm_iso"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Memory</td>
                                                        <!-- memory inputan -->
                                                        <td id="confirm_memory_vm"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Net0</td>
                                                        <!-- interface inputan -->
                                                        <td id="confirm_interface_vm"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Node Name</td>
                                                        <td>{{id_node}}</td>
                                                    </tr>

                                                    <tr>
                                                        <td>OS Type</td>
                                                        <!-- ostype inputan -->
                                                        <td id="confirm_ostype"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Scsi0</td>

                                                        <!-- disk inputan -->
                                                        <td id="confirm_disk_size_vm"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Scsihw</td>
                                                        <!-- scis inputan -->
                                                        <td id="confirm_scsihw"></td>
                                                    </tr>


                                                    <tr>
                                                        <td>Sockets</td>
                                                        <!-- sockets inputan -->
                                                        <td id="confirm_sockets"></td>
                                                    </tr>

                                                    <tr>
                                                        <td>Vmid</td>
                                                        <!-- vmid inputan -->
                                                        <td id="confirm_vm-id"></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div style="overflow:auto;">
                                        <div style="float:right;">
                                        <button class="btn btn-primary" type="button" id="prevBtn_addVirtualMachine" onclick="nextPrev(-1, 'addVirtualMachine')">Previous</button>
                                        <button class="btn btn-success" type="button" id="nextBtn_addVirtualMachine" onclick="nextPrev(1, 'addVirtualMachine')">Next</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
        </div>
        </div>
        <!-- end modalbox tambah Virtual Machine-->


        <script>
            document.addEventListener("DOMContentLoaded", function() {
                var toggleButton = document.getElementById("toggleForm");
                var routeTitle = document.getElementById("routeTitle");
                var preRouteForm = document.getElementById("preRouteForm");
                var postRouteForm= document.getElementById("postRouteForm");
    
                toggleButton.addEventListener("click", function() {
                    // Toggle tampilan form saat tombol ditekan
                    if (postRouteForm.style.display === "none") {
                        preRouteForm.style.display = "none";
                        postRouteForm.style.display = "block";
                        routeTitle.textContent = "Post Routing";
                    } else {
                        preRouteForm.style.display = "block";
                        postRouteForm.style.display = "none";
                        routeTitle.textContent = "Pre Routing";
                    }
                });
            });
    
    
        </script>
        
        <!-- Form -->
    
        <!-- ketika mengirim form maka tombol tambah akan disable -->
        <script>
            document.getElementById("preRouting").addEventListener("submit", function() {
                document.getElementById("preRouteButton").disabled = true;
            });
        </script>
    
        <script>
            document.getElementById("postRouting").addEventListener("submit", function() {
                document.getElementById("postRouteButton").disabled = true;
            });
        </script>

        <!-- sweetalert2 -->
        <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
        <script src="{% static 'plugins/sweetalert2/sweetalert2.all.min.js' %}"></script>
        <script src="{% static 'plugins/sweetalert2/myscript.js' %}"></script>

        <script src="https://unpkg.com/feather-icons"></script>

        <!-- script input radio-->
        <script>
            // Tombol IP V4 Container
            // Membuat referensi ke elemen-elemen HTML
            const staticIPv4Radio = document.getElementById("static_ipv4");
            const dhcpIPv4Radio = document.getElementById("dhcp_ipv4");
            const ipv4NetworkInput = document.getElementById("ipv4_network");
            const gatewayNetworkInput = document.getElementById("gateway_network");
            const netmaskInput = document.getElementById("netmask");

            // Menambahkan event listener untuk radio button Static
            staticIPv4Radio.addEventListener("change", function() {
            if (staticIPv4Radio.checked) {
                ipv4NetworkInput.disabled = false;
                gatewayNetworkInput.disabled = false;
                netmaskInput.disabled = false;
                dhcpIPv4Radio.checked = false; // Uncheck DHCP radio
                
            }
            });

            // Menambahkan event listener untuk radio button DHCP
            dhcpIPv4Radio.addEventListener("change", function() {
            if (dhcpIPv4Radio.checked) {
                ipv4NetworkInput.disabled = true;
                gatewayNetworkInput.disabled = true;
                netmaskInput.disabled = true;
                 staticIPv4Radio.checked = false; // Uncheck Static radio
            }
            });

            // Tombol IP V4 Virtual Machine
            // Membuat referensi ke elemen-elemen HTML
            const staticIPv4RadioVM = document.getElementById("static_ipv4_vm");
            const dhcpIPv4RadioVM = document.getElementById("dhcp_ipv4_vm");
            const ipv4NetworkInputVM = document.getElementById("ipv4_network_vm");
            const gatewayNetworkInputVM = document.getElementById("gateway_network_vm");
            const netmaskInputVM = document.getElementById("netmask_vm");

            // Menambahkan event listener untuk radio button Static
            staticIPv4RadioVM.addEventListener("change", function() {
            if (staticIPv4RadioVM.checked) {
                ipv4NetworkInputVM.disabled = false;
                gatewayNetworkInputVM.disabled = false;
                netmaskInputVM.disabled = false;
                dhcpIPv4RadioVM.checked = false; // Uncheck DHCP radio
                
            }
            });

            // Menambahkan event listener untuk radio button DHCP
            dhcpIPv4RadioVM.addEventListener("change", function() {
            if (dhcpIPv4RadioVM.checked) {
                ipv4NetworkInputVM.disabled = true;
                gatewayNetworkInputVM.disabled = true;
                netmaskInputVM.disabled = true;
                 staticIPv4RadioVM.checked = false; // Uncheck Static radio
            }
            });
        </script>

        <script>
            let idNode = '';
            const idNodeInput = document.querySelector('.id_node'); // Ambil elemen input dengan class 'id_node'
            idNode = idNodeInput.value; // Ambil nilai dari input

            function createCtCard(ctData) {
                const ctCard = document.createElement('div');
                ctCard.classList.add('col-12', 'col-md-6', 'col-xxl-3', 'd-flex', 'order-2', 'order-xxl-3');

                const cardContainer = document.createElement('div');
                cardContainer.classList.add('card', 'flex-fill', 'w-100');
                ctCard.appendChild(cardContainer);

                const ctDetail = document.createElement('div');
                ctDetail.classList.add('d-flex', 'justify-content-end');
                cardContainer.appendChild(ctDetail);

                const detailLink = document.createElement('a');
                detailLink.classList.add('btn', 'btn-primary', 'mt-3');
                detailLink.href = `/detail-container/${idNode}/${ctData.container_vmid}`;
                detailLink.textContent = 'Detail';
                // ctDetail.appendChild(detailLink);

                // Logika untuk menentukan apakah tombol ditampilkan atau disembunyikan
                if (ctData.container_status === "running") {
                    ctDetail.appendChild(detailLink); // Menambahkan tombol hanya jika statusnya 'running'
                }

                const detailSpace = document.createElement('div');
                detailSpace.innerHTML = '&nbsp; &nbsp; &nbsp;';
                ctDetail.appendChild(detailSpace);

                const cardHeader = document.createElement('div');
                cardHeader.classList.add('card-header');
                cardContainer.appendChild(cardHeader);

                const ctName = document.createElement('h5');
                ctName.classList.add('card-title', 'mb-0', 'pb-2');
                ctName.textContent = ctData.container_name + ' - ' +ctData.container_vmid;
                cardHeader.appendChild(ctName);


                const ctStatus = document.createElement('span');
                ctStatus.classList.add('badge', ctData.container_status === "running" ? 'bg-success' : 'bg-danger');
                ctStatus.textContent = ctData.container_status;
                cardHeader.appendChild(ctStatus);

                const chartContainer = document.createElement('div');
                chartContainer.classList.add('py-3', 'mx-auto');

                const chartIconContainer = document.createElement('div');
                chartIconContainer.classList.add('chart', 'chart-xs');
                cardContainer.appendChild(chartContainer);

                const chartIcon = document.createElement('i');
                chartIcon.classList.add('align-middle', 'me-1');
                chartIcon.setAttribute('data-feather', 'box');
                chartIcon.style.width = '180px';
                chartIcon.style.height = '180px';

                chartIconContainer.appendChild(chartIcon);
                chartContainer.appendChild(chartIconContainer);

                const cardBody = document.createElement('div');
                cardBody.classList.add('card-body', 'd-flex');
                cardContainer.appendChild(cardBody);

                const cardRow = document.createElement('div');
                cardRow.classList.add('align-items-center', 'w-100');
                cardBody.appendChild(cardRow);

                const table = document.createElement('table');
                table.classList.add('table', 'mb-0');
                cardRow.appendChild(table);

                const tableBody = document.createElement('tbody');
                table.appendChild(tableBody);

                const rows = [
                    { label: 'CPU', value: `${ctData.container_cpu}% of ${ctData.container_maxcpu} CPU` },
                    { label: 'Memori', value: `${ctData.container_mem} GB - ${ctData.container_maxmem} GB` },
                    { label: 'Storage', value: `${ctData.container_disk} GB - ${ctData.container_maxdisk} GB` },
                    { label: 'Uptime', value: `${ctData.container_hours} jam ${ctData.container_minutes} menit ${ctData.container_seconds} detik` }
                ];

                rows.forEach(rowData => {
                    const row = document.createElement('tr');
                    const cellLabel = document.createElement('td');
                    cellLabel.textContent = rowData.label;
                    const cellValue = document.createElement('td');
                    cellValue.textContent = rowData.value;
                    cellValue.classList.add('text-end');
                    row.appendChild(cellLabel);
                    row.appendChild(cellValue);
                    tableBody.appendChild(row);
                });
                
                const textCenterDiv = document.createElement('div');
                textCenterDiv.classList.add('text-center', 'mt-3');
                cardRow.appendChild(textCenterDiv);

                const buttons = [
                    { label: 'Start', href: `/start-container/${idNode}/${ctData.container_vmid}`, class: 'btn btn-success me-2 start-container' },
                    { label: 'Reboot', href: `/reboot-container/${idNode}/${ctData.container_vmid}`, class: 'btn btn-primary me-2 reboot-container' },
                    { label: 'Stop', href: `/stop-container/${idNode}/${ctData.container_vmid}`, class: 'btn btn-warning me-2 stop-container' },
                    // { label: 'Remove', href: `/remove-container/${ctData.container_vmid}`, class: 'btn btn-danger mt-5 text remove-container' }
                ];

                buttons.forEach(buttonData => {
                    const button = document.createElement('a');
                    button.setAttribute('href', buttonData.href);
                    button.className =  buttonData.class; // Menambahkan kelas-kelas tombol
                    button.textContent = buttonData.label;

                    console.log(button)

                    textCenterDiv.appendChild(button);
                });

                const removeDiv = document.createElement('div');
                removeDiv.classList.add('text-center');
                cardRow.appendChild(removeDiv);

                const removeLink = document.createElement('a');
                removeLink.setAttribute('href', `/remove-container/${idNode}/${ctData.container_vmid}`);
                removeLink.classList.add('btn', 'btn-danger', 'mt-3', 'text', 'remove-container');
                removeLink.textContent = 'Remove';
                removeDiv.appendChild(removeLink);


                return ctCard;
            }
            
            function ambilDataCtTerbaru() {
                const idNodeInput = document.querySelector('.id_node'); // Ambil elemen input dengan class 'id_node'
                idNode = idNodeInput.value; // Ambil nilai dari input
    
                fetch(`/data_api?action=view_data_ct_resources&id_node=${idNode}`, {
                    method: 'GET',
                })
                .then(response => response.json())
                .then(data => {
                    const dataContainer = document.getElementById('data-container');
                    dataContainer.innerHTML = '';
    
                    let ctsData = data.container_data;
                    ctsData.sort((a, b) => a.container_name.localeCompare(b.container_name));
    
                    ctsData.forEach(ctData => {
                        const ctCard = createCtCard(ctData);
                        dataContainer.appendChild(ctCard);
                    });
                    // Memanggil fungsi Feather Icons untuk merender ikon
                    feather.replace();
                })
                .catch(error => console.error('Gagal mengambil data terbaru:', error));
            }
    
            
            // Atur interval untuk melakukan pembaruan data setiap 60 detik
            setInterval(ambilDataCtTerbaru, 1000); // 60000 ms = 60 detik
        </script>

        <script>
            function createVmCard(vmData) {
                const vmCard = document.createElement('div');
                vmCard.classList.add('col-12', 'col-md-6', 'col-xxl-3', 'd-flex', 'order-2', 'order-xxl-3');

                const cardContainer = document.createElement('div');
                cardContainer.classList.add('card', 'flex-fill', 'w-100');
                vmCard.appendChild(cardContainer);

                const vmDetail = document.createElement('div');
                vmDetail.classList.add('d-flex', 'justify-content-end');
                cardContainer.appendChild(vmDetail);

                const detailLink = document.createElement('a');
                detailLink.classList.add('btn', 'btn-primary', 'mt-3');
                detailLink.href = `/detail-vm/${vmData.vm_name}`;
                detailLink.textContent = 'Detail';
                vmDetail.appendChild(detailLink);

                const detailSpace = document.createElement('div');
                detailSpace.innerHTML = '&nbsp; &nbsp; &nbsp;';
                vmDetail.appendChild(detailSpace);

                const cardHeader = document.createElement('div');
                cardHeader.classList.add('card-header');
                cardContainer.appendChild(cardHeader);

                const vmName = document.createElement('h5');
                vmName.classList.add('card-title', 'mb-0', 'pb-2');
                vmName.textContent = vmData.vm_name + ' - ' + vmData.vm_vmid;
                cardHeader.appendChild(vmName);

                const vmStatus = document.createElement('span');
                vmStatus.classList.add('badge', vmData.container_status === "running" ? 'bg-success' : 'bg-danger');
                vmStatus.textContent = vmData.vm_status;
                cardHeader.appendChild(vmStatus);

                const chartContainer = document.createElement('div');
                chartContainer.classList.add('py-3', 'mx-auto');

                const chartIconContainer = document.createElement('div');
                chartIconContainer.classList.add('chart', 'chart-xs');

                const chartIcon = document.createElement('i');
                chartIcon.classList.add('align-middle', 'me-1');
                chartIcon.setAttribute('data-feather', 'airplay');
                chartIcon.style.width = '180px';
                chartIcon.style.height = '180px';

                chartIconContainer.appendChild(chartIcon);
                chartContainer.appendChild(chartIconContainer);
                cardContainer.appendChild(chartContainer);

                const cardBody = document.createElement('div');
                cardBody.classList.add('card-body', 'd-flex');
                cardContainer.appendChild(cardBody);

                const cardRow = document.createElement('div');
                cardRow.classList.add('align-items-center', 'w-100');
                cardBody.appendChild(cardRow);

                const table = document.createElement('table');
                table.classList.add('table', 'mb-0');
                cardRow.appendChild(table);

                const tableBody = document.createElement('tbody');
                table.appendChild(tableBody);

                const rows = [
                    { label: 'CPU', value: `${vmData.vm_cpu}% of ${vmData.vm_maxcpu} CPU` },
                    { label: 'Memori', value: `${vmData.vm_mem} GB - ${vmData.vm_maxmem} GB` },
                    { label: 'Storage', value: `${vmData.vm_disk} GB - ${vmData.vm_maxdisk} GB` },
                    { label: 'Uptime', value: `${vmData.vm_hours} jam ${vmData.vm_minutes} menit ${vmData.vm_seconds} detik` }
                ];

                rows.forEach(rowData => {
                    const row = document.createElement('tr');
                    const cellLabel = document.createElement('td');
                    cellLabel.textContent = rowData.label;
                    const cellValue = document.createElement('td');
                    cellValue.textContent = rowData.value;
                    cellValue.classList.add('text-end');
                    row.appendChild(cellLabel);
                    row.appendChild(cellValue);
                    tableBody.appendChild(row);
                });

                const textCenterDiv = document.createElement('div');
                textCenterDiv.classList.add('text-center', 'mt-2');
                cardRow.appendChild(textCenterDiv);

                const buttons = [
                    { label: 'Start', href: `/start-virtual_machine/${idNode}/${vmData.vm_vmid}`, class: ('btn btn-success me-1 start-virtual_machine') },
                    {label: 'Reboot', href: `/reboot-virtual_machine/${idNode}/${vmData.vm_vmid}`, class: ('btn btn-primary me-1 reboot-virtual_machine') },
                    { label: 'Stop', href: `/stop-virtual_machine/${idNode}/${vmData.vm_vmid}`, class: ('btn btn-warning me-1 stop-virtual_machine') },
                    // { label: 'Remove', href: `/remove-container/${vmData.container_vmid}`, class: ('btn', 'btn-danger', 'mt-3', 'text', 'remove-container') }
                ];

                buttons.forEach(buttonData => {
                    const button = document.createElement('a');
                    button.setAttribute('href', buttonData.href);
                    button.classList.add(...buttonData.class.split(' ')); // Menambahkan kelas-kelas tombol
                    button.textContent = buttonData.label;
                    textCenterDiv.appendChild(button);
                });

                const removeDiv = document.createElement('div');
                removeDiv.classList.add('text-center');
                cardRow.appendChild(removeDiv);

                const removeLink = document.createElement('a');
                removeLink.setAttribute('href', `/remove-virtual_machine//${idNode}/${vmData.vm_vmid}`);
                removeLink.classList.add('btn', 'btn-danger', 'mt-3', 'text', 'remove-virtual_machine');
                removeLink.textContent = 'Remove';
                removeDiv.appendChild(removeLink);

                return vmCard;
            }

        function ambilDataVmTerbaru() {

            fetch(`/data_api?action=view_data_vm_resources&id_node=${idNode}`, {
                method: 'GET',
            })
            .then(response => response.json())
            .then(data => {
                const dataContainer = document.getElementById('data-vm');
                dataContainer.innerHTML = '';

                let vmsData = data.vm_data;
                vmsData.sort((a, b) => a.vm_name.localeCompare(b.vm_name));

                vmsData.forEach(vmData => {
                    const vmCard = createVmCard(vmData);
                    dataContainer.appendChild(vmCard);
                });
                // Memanggil fungsi Feather Icons untuk merender ikon
                feather.replace();
            })
            .catch(error => console.error('Gagal mengambil data terbaru:', error));
        }

        
        // Atur interval untuk melakukan pembaruan data setiap 60 detik
        setInterval(ambilDataVmTerbaru, 1000); // 60000 ms = 60 detik
        </script>
        
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- scripts data history inputan -->
        <script>

            // Container Confirm Configuration
            // Function to update the confirmation table
            function updateConfirmationTable() {
                // Get the values from the input fields
                var disk_size = document.getElementById("disk_size").value;
                var storage_disk = document.getElementById("storage_disk").value;
                var rootfs = storage_disk + ":" + disk_size

                var ct_id = document.getElementById("ct-id").value;
                var network_interfaces = document.getElementById("network_interfaces").value;
                var cores = document.getElementById("cores").value;
                var memory = document.getElementById("memory").value + " MB";
                var swap = document.getElementById("memory_swap").value + " MB";
                var hostname = document.getElementById("hostname").value;

                // Get the values from the select fields
                var ostemplateSelect = document.getElementById("container_templated");
                var resourcePoolSelect = document.getElementById("resource_pool");

                var ostemplate = ostemplateSelect.options[ostemplateSelect.selectedIndex].text;
                var resourcePool = resourcePoolSelect.options[resourcePoolSelect.selectedIndex].text;


                // Update the confirmation table cells
                document.getElementById("confirm_rootfs").textContent = rootfs;
                document.getElementById("confirm_net").textContent = network_interfaces;
                document.getElementById("confirm_ct-id").textContent = ct_id;
                document.getElementById("confirm_hostname").textContent = hostname;
                document.getElementById("confirm_pool").textContent = resourcePool;
                document.getElementById("confirm_core").textContent = cores;
                document.getElementById("confirm_memory").textContent = memory;
                document.getElementById("confirm_swap").textContent = swap;
                document.getElementById("confirm_ostemplate").textContent = ostemplate;

            }

            // Add an event listener to the input field to trigger the update
            document.getElementById("network_interfaces").addEventListener("input", updateConfirmationTable);
            document.getElementById("disk_size").addEventListener("input", updateConfirmationTable);
            document.getElementById("storage_disk").addEventListener("change", updateConfirmationTable);
            document.getElementById("hostname").addEventListener("input", updateConfirmationTable);
            document.getElementById("cores").addEventListener("input", updateConfirmationTable);
            document.getElementById("memory").addEventListener("input", updateConfirmationTable);
            document.getElementById("memory_swap").addEventListener("input", updateConfirmationTable);
            document.getElementById("ct-id").addEventListener("input", updateConfirmationTable);
            

            
            // Add an event listener to the select element to trigger the update
            document.getElementById("resource_pool").addEventListener("change", updateConfirmationTable);
            document.getElementById("container_templated").addEventListener("change", updateConfirmationTable);
        </script>

        <script>

            function updateFirewallStatus() {
                var firewallCheckbox = document.getElementById("firewall_vm");
                var firewallStatus = firewallCheckbox.checked ? "on" : "off";

                return firewallStatus;
            }

            // Virtual Machine Confirm Configuration: 
            function updateConfirmationTableVM() {
                // Get the values from the input fields
                var vm_id = document.getElementById("vm-id").value;
                var cores_vm = document.getElementById("cores_vm").value;
    
                var sockets = document.getElementById("sockets").value;
                var memory = document.getElementById("memory_vm").value + " MB";
                var model_network = document.getElementById("model_network").value;
                var bridge = document.getElementById("bridge_vm").value;


                 // Tambahkan event listener untuk memanggil fungsi ketika status checkbox berubah
                firewall1 =  document.getElementById("firewall_vm").addEventListener("change", updateFirewallStatus);

                // Panggil fungsi updateFirewallStatus untuk menginisialisasi status firewall saat halaman dimuat
                firewall = updateFirewallStatus();

                var ostype = document.getElementById("ostype").value;
                var storage_vm = document.getElementById("storage_virtual_machine").value;
                var disk_size_vm = document.getElementById("disk_size_vm").value;
                var scsihw = document.getElementById("scsihw").value;

                // Get the values from the select fields
                var isoSelect = document.getElementById("iso_images");
                var iso_images = isoSelect.options[isoSelect.selectedIndex].text;


                // Update the confirmation table cells
                document.getElementById("confirm_vm-id").textContent = vm_id;
                document.getElementById("confirm_iso").textContent = iso_images;

                document.getElementById("confirm_ostype").textContent = ostype;
                document.getElementById("confirm_core_vm").textContent = cores_vm;
                
                document.getElementById("confirm_memory_vm").textContent = memory;
                document.getElementById("confirm_interface_vm").textContent = "model="+ model_network + ",bridge=" + bridge + ",firewall=" + firewall;
                
                document.getElementById("confirm_disk_size_vm").textContent = storage_vm + ":" + disk_size_vm + ",iothread=on";
                document.getElementById("confirm_scsihw").textContent = scsihw;
                document.getElementById("confirm_sockets").textContent = sockets;
                
            }

            // Add an event listener to the input field to trigger the update
            document.getElementById("vm-id").addEventListener("input", updateConfirmationTableVM);

            document.getElementById("cores_vm").addEventListener("input", updateConfirmationTableVM);
            document.getElementById("sockets").addEventListener("input", updateConfirmationTableVM);
            document.getElementById("memory_vm").addEventListener("input", updateConfirmationTableVM);
            document.getElementById("model_network").addEventListener("change", updateConfirmationTableVM);
            document.getElementById("bridge_vm").addEventListener("input", updateConfirmationTableVM);
            document.getElementById("firewall_vm").addEventListener("input", updateConfirmationTableVM);
            document.getElementById("ostype").addEventListener("change", updateConfirmationTableVM);
            document.getElementById("storage_virtual_machine").addEventListener("change", updateConfirmationTableVM);
            document.getElementById("disk_size_vm").addEventListener("change", updateConfirmationTableVM);
            document.getElementById("scsihw").addEventListener("change", updateConfirmationTableVM);

            
            // Add an event listener to the select element to trigger the update
            document.getElementById("iso_images").addEventListener("change", updateConfirmationTableVM);
        </script>


        <!-- script multistep -->
        <script>
            var currentTab = {
                addContainer: 0,
                addVirtualMachine: 0,
            };

            window.onload = function () {
                var modalName = "addContainer";
                var modalName2 = "addVirtualMachine";

                if(modalName === "addContainer"){
                      showTab(0, modalName); // Tampilkan tab awal saat halaman dimuat
                        var prevBtn = document.getElementById("prevBtn_" + modalName);
                    prevBtn.style.display = "none"; // Sembunyikan tombol "Previous" pada tab pertama
                }
                if(modalName2 === "addVirtualMachine"){
                    showTab(0, modalName2); // Tampilkan tab awal saat halaman dimuat
                    var prevBtn = document.getElementById("prevBtn_" + modalName2);
                    prevBtn.style.display = "none"; // Sembunyikan tombol "Previous" pada tab pertama
                }
            };

            function showTab(n, modalName) {
                // This function will display the specified tab of the form...
                var x = document.getElementsByClassName("tab-" + modalName);

                // console.log("var x = "+ x);
                x[n].style.display = "block";

                var prevBtn = document.getElementById("prevBtn_" + modalName);
                var nextBtn = document.getElementById("nextBtn_" + modalName);

                // ... and fix the Previous/Next buttons:
                if (n == 0) {
                    var prevBtn = document.getElementById("prevBtn_" + modalName);
                    prevBtn.style.display = "none";
                } else {
                    prevBtn.style.display = "inline";
                }
                
                if (n == (x.length - 1)) {
                    nextBtn.innerHTML = "Submit";
                } else {
                    nextBtn.innerHTML = "Next";
                }
                // ... and run a function that will display the correct step indicator:
                fixStepIndicator(n, modalName);
            }

            function nextPrev(n, modalName) {
                // This function will figure out which tab to display
                var x = document.getElementsByClassName("tab-" + modalName);

                // Exit the function if any field in the current tab is invalid:
                // if (n == 1 && !validateForm()) return false;

                // Hide the current tab:
                x[currentTab[modalName]].style.display = "none";

                // Increase or decrease the current tab by 1:
                currentTab[modalName] = currentTab[modalName] + n;

                // if you have reached the end of the form...
                if (currentTab[modalName] >= x.length) {
                    // ... the form gets submitted:
                    var formId = "form" + modalName; 
                    document.getElementById(formId).submit();

                    // Optional: Close the modal after submit
                    var modal = document.getElementById(modalName);
                    if (modal) {
                        modal.style.display = "none";
                    }
                    
                    return false;
                }
                // Otherwise, display the correct tab:
                showTab(currentTab[modalName], modalName);
            }

            function validateForm(modalName) {
                // This function deals with the validation of the form fields
                var x, y, i, valid = true;
                x = document.getElementsByClassName("tab-"+ modalName);
                y = x[currentTab[modalName]].getElementsByTagName("input");


                // A loop that checks every input field in the current tab:
                for (i = 0; i < y.length; i++) {
                    // If a field is empty...
                    if (y[i].value == "") {
                        // add an "invalid" class to the field:
                        y[i].className += " invalid";
                        // and set the current valid status to false
                        valid = false;
                    }
                }
                // If the valid status is true, mark the step as finished and valid:
                if (valid) {
                    document.getElementsByClassName("step")[currentTab[modalName]].className += " finish";
                }
                return valid; // return the valid status
            }

            function fixStepIndicator(n, modalName) {
                // This function removes the "active" class of all steps...
                var i, x = document.getElementsByClassName("step-"+ modalName);
                for (i = 0; i < x.length; i++) {
                    x[i].className = x[i].className.replace(" active", "");
                }
                //... and adds the "active" class to the current step:
                x[n].className += " active";
            }
        </script>
        
       
        

<!-- end konten -->
{% endblock content %}